---
export const prerender = false;

type SupportedLanguage = 'es' | 'en';

function getDefaultLanguage(acceptLanguageHeader: string | null): SupportedLanguage {
    if (!acceptLanguageHeader) return 'es';
    const preferredLanguages = acceptLanguageHeader
        .split(',')
        .map(lang => lang.split(';')[0].trim().toLowerCase());
    for (const lang of preferredLanguages) {
        if (lang.startsWith('es')) return 'es';
        if (lang.startsWith('en')) return 'en';
    }
    return 'es';
}

const acceptLanguage = Astro.request.headers.get('accept-language');

const defaultLanguage = getDefaultLanguage(acceptLanguage);
return Astro.redirect(`/${defaultLanguage}`);
---